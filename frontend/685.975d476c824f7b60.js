"use strict";(self.webpackChunkrawncafe_web=self.webpackChunkrawncafe_web||[]).push([[685],{9685:(I,m,l)=>{l.r(m),l.d(m,{LoyaltyCardModule:()=>A});var c=l(9808),t=l(4893),f=l(520),_=l(3116),x=l(373),u=l(5697);function y(i,a){if(1&i&&(t.TgZ(0,"div",22),t._UZ(1,"img",26),t.qZA()),2&i){const e=t.oxw();t.MGl("ngClass","overlay ",e.isLoading?"active":"","")}}function w(i,a){if(1&i&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.Oqu(e.rewardMessage)}}function C(i,a){if(1&i){const e=t.EpF();t.TgZ(0,"button",27),t.NdJ("click",function(){t.CHM(e);const o=t.oxw();return o.redeemReward(o.selectedReward.id)}),t._uU(1),t.qZA()}if(2&i){const e=t.oxw();t.xp6(1),t.Oqu(e.redeemButton)}}const h=function(i){return{show:i}};function b(i,a){if(1&i){const e=t.EpF();t.TgZ(0,"div",1)(1,"div",2)(2,"span",3),t.NdJ("click",function(){return t.CHM(e),t.oxw().closeGrantPointsModal()}),t._uU(3,"\xd7"),t.qZA(),t.TgZ(4,"div")(5,"h2"),t._uU(6,"Confirm Grant Points"),t.qZA(),t.TgZ(7,"p"),t._uU(8),t.ALo(9,"titlecase"),t.qZA()(),t.TgZ(10,"div",28)(11,"button",29),t.NdJ("click",function(){return t.CHM(e),t.oxw().confirmGrantPoints()}),t._uU(12,"Yes, Grant Points"),t.qZA(),t.TgZ(13,"button",30),t.NdJ("click",function(){return t.CHM(e),t.oxw().closeGrantPointsModal()}),t._uU(14,"Cancel"),t.qZA()()()()}if(2&i){const e=t.oxw();t.Q6J("ngClass",t.VKq(4,h,e.isGrantPointsModalVisible)),t.xp6(8),t.hij("Are you sure you want to grant points to ",t.lcZ(9,2,(null==e.user?null:e.user.name)||"this user"),"?")}}function v(i,a){if(1&i){const e=t.EpF();t.TgZ(0,"div",34),t.NdJ("click",function(){t.CHM(e);const o=t.oxw(),r=o.$implicit,s=o.index;return t.oxw().showRewardDetails(r,s)}),t._UZ(1,"img",35),t.TgZ(2,"span",36),t._uU(3),t.qZA()()}if(2&i){const e=t.oxw().$implicit;t.xp6(3),t.Oqu(e.title)}}function M(i,a){if(1&i&&t._UZ(0,"img",37),2&i){const e=t.oxw().$implicit;t.Q6J("src","credit-logo"===e.title?"assets/images/stampedcup.png":"assets/images/whitecup.png",t.LSH)}}function P(i,a){if(1&i&&(t.TgZ(0,"div",31),t.YNc(1,v,4,1,"div",32),t.YNc(2,M,1,1,"img",33),t.qZA()),2&i){const e=a.$implicit;t.xp6(1),t.Q6J("ngIf","credit-logo"!==e.title&&"default-logo"!==e.title),t.xp6(1),t.Q6J("ngIf","credit-logo"===e.title||"default-logo"===e.title)}}function Z(i,a){if(1&i){const e=t.EpF();t.TgZ(0,"button",27),t.NdJ("click",function(){return t.CHM(e),t.oxw().openGrantPointsModal()}),t._uU(1," Grant Points "),t.qZA()}}const O=function(i){return["card-type",i]};let T=(()=>{class i{constructor(e,n,o,r,s){this.http=e,this.authService=n,this.loyaltyCardService=o,this.route=r,this.router=s,this.isLoading=!1,this.adminButtonRole=["admin","super-admin"],this.userRole="user",this.userId="",this.rewards=[],this.isRedeeming=!1,this.isGrantingPoints=!1,this.rewardTitle="",this.logos=[],this.canRedeem=!1,this.redeemableRewards=[],this.rewardMessage="",this.isModalVisible=!1,this.redeemButton="Redeem Now",this.isGrantPointsModalVisible=!1,this.selectedReward={id:"",description:"",title:""},this.routeSub=null}ngOnInit(){this.userRole=this.authService.getUserRole();const e=this.authService.getUserId();this.routeSub=this.route.paramMap.subscribe(n=>{this.userId=n.get("user_id")||e,"user"===this.userRole&&this.userId!==e&&this.router.navigate(["/loyalty-card",e]),this.userId||this.router.navigate(["/loyalty-card",e]),this.getUserData(this.userId)})}getUserData(e){!e||(this.isLoading=!0,setTimeout(()=>{this.loyaltyCardService.getUserDetails(e).subscribe(n=>{this.user=n,this.getRewards(n),this.isLoading=!1},n=>{console.error("Error fetching user data:",n),this.isLoading=!1})},2e3))}generateLogos(e,n){var o;let r=[];const q={silver:10,gold:20,platinum:30}[null===(o=this.user)||void 0===o?void 0:o.card_type]||0;for(let p=1;p<=q;p++){const d=n.find(U=>U.required_points===p);r.push(p<=e?d?{id:d._id,points:e,description:d.reward_description,title:`${d.reward_name}`}:{id:"",points:e,description:"",title:"credit-logo"}:d?{id:d._id,points:e,description:d.reward_description,title:`${d.reward_name}`}:{id:"",points:e,description:"",title:"default-logo"})}return r}redeemReward(e){!e||this.isRedeeming||(this.isRedeeming=!0,this.isLoading=!0,console.log("reward_id :",e),this.loyaltyCardService.addRewardToUser(this.userId,e).subscribe({next:n=>{console.log("Reward redeemed successfully:",n),alert("Reward redeemed successfully!")},error:n=>{console.error("Error redeeming reward:",n),alert("There was an error redeeming the reward. Please try again.")},complete:()=>{this.isRedeeming=!1,this.isLoading=!1,window.location.reload()}}))}getRewards(e){const n=this.user.points;this.loyaltyCardService.getAllRewards().subscribe(o=>{this.rewards=o,this.logos=this.generateLogos(n,this.rewards)},o=>{console.error("Error fetching rewards:",o)})}showRewardDetails(e,n){const o=n+1;this.selectedReward=e,this.isModalVisible=!0;const r=this.user,s=this.authService.getUserRole();e&&o<=r.points&&!r.redeem_requests.includes(e.id)&&!r.rewards.includes(e.id)?"user"===s&&(this.canRedeem=!0,this.redeemButton="Redeem Reward",this.rewardTitle="Congratulations!",this.rewardMessage="You may now redeem your reward."):e&&r.redeem_requests.includes(e.id)&&!r.rewards.includes(e.id)?"admin"===s||"super-admin"===s?(this.canRedeem=!0,this.redeemButton="Grant Reward",this.rewardTitle="Claim Request!",this.rewardMessage=""):(this.canRedeem=!1,this.rewardTitle="Request Sent!",this.rewardMessage="Your reward is now available for redemption at our physical store."):e&&!r.redeem_requests.includes(e.id)&&r.rewards.includes(e.id)&&(this.canRedeem=!1,this.rewardTitle="Reward Claimed!",this.rewardMessage="Your reward has already been claimed!")}closeModal(){this.clearProperties()}clearProperties(){this.isModalVisible=!1,this.selectedReward={id:"",description:"",title:""},this.redeemButton="",this.rewardTitle="",this.rewardMessage="",this.canRedeem=!1}openGrantPointsModal(){this.isGrantPointsModalVisible=!0}closeGrantPointsModal(){this.isGrantPointsModalVisible=!1}confirmGrantPoints(){this.closeGrantPointsModal(),this.grantPoints()}grantPoints(){"user"===this.userRole||!this.userId||this.isGrantingPoints||(this.isGrantingPoints=!0,this.isLoading=!0,this.loyaltyCardService.addPoints(this.userId).subscribe({next:e=>{console.log("Points granted successfully:",e),alert("Points granted successfully!")},error:e=>{console.error("Error granting points:",e),alert("There was an error granting points. Please try again.")},complete:()=>{this.isGrantingPoints=!1,this.isLoading=!1,window.location.reload()}}))}ngOnDestroy(){this.routeSub&&this.routeSub.unsubscribe()}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(f.eN),t.Y36(_.e),t.Y36(x.y),t.Y36(u.gz),t.Y36(u.F0))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-loyalty-card"]],decls:45,vars:27,consts:[[3,"ngClass",4,"ngIf"],[1,"modal",3,"ngClass"],[1,"modal-content"],[1,"close-btn",3,"click"],[4,"ngIf"],[1,"reward-description"],["class","loyalty-btn",3,"click",4,"ngIf"],["class","modal",3,"ngClass",4,"ngIf"],[1,"card-container"],[1,"loyalty-card"],[1,"card-header"],[1,"header-top-row"],[1,"logo-container"],["src","assets/images/rawncafelogo.png","alt","RawnCafe Logo",1,"logo"],["src","assets/images/Text.png","alt","RawnCafe",1,"logo-text"],[1,"header-title"],[1,"card-info"],[1,"name"],[1,"card-number"],[1,"card-info-2"],[1,"expiration"],[1,"points"],[3,"ngClass"],[1,"item-collection"],["class","item",4,"ngFor","ngForOf"],[1,"loyalty-btn-container"],["src","assets/images/ezgif.com-speed.gif","alt","Loading...",1,"loader-img"],[1,"loyalty-btn",3,"click"],[1,"modal-actions","align-items-center"],[1,"btn","btn-danger","mx-3",3,"click"],[1,"btn","btn-secondary","mx-3",3,"click"],[1,"item"],[3,"click",4,"ngIf"],["alt","Logo",3,"src",4,"ngIf"],[3,"click"],["src","assets/images/whitecup.png","alt","Reward Image"],[1,"reward-logo"],["alt","Logo",3,"src"]],template:function(e,n){if(1&e&&(t.YNc(0,y,2,1,"div",0),t.TgZ(1,"div",1)(2,"div",2)(3,"span",3),t.NdJ("click",function(){return n.closeModal()}),t._uU(4,"\xd7"),t.qZA(),t.TgZ(5,"div")(6,"h2"),t._uU(7),t.qZA(),t.YNc(8,w,2,1,"span",4),t.qZA(),t.TgZ(9,"div",5)(10,"p")(11,"b"),t._uU(12),t.ALo(13,"uppercase"),t.qZA()(),t.TgZ(14,"p"),t._uU(15),t.qZA()(),t.YNc(16,C,2,1,"button",6),t.qZA()(),t.YNc(17,b,15,6,"div",7),t.TgZ(18,"div",8)(19,"div",9)(20,"div",10)(21,"div",11)(22,"div",12),t._UZ(23,"img",13)(24,"img",14),t.TgZ(25,"div",15),t._uU(26,"Loyalty Card"),t.qZA()()(),t.TgZ(27,"div",16)(28,"p",17),t._uU(29),t.ALo(30,"titlecase"),t.qZA(),t.TgZ(31,"p",18),t._uU(32),t.qZA(),t.TgZ(33,"div",19)(34,"p",20),t._uU(35),t.ALo(36,"date"),t.qZA(),t.TgZ(37,"p",21),t._uU(38),t.qZA()()()(),t.TgZ(39,"div",22),t._uU(40),t.qZA(),t.TgZ(41,"div",23),t.YNc(42,P,3,2,"div",24),t.qZA()(),t.TgZ(43,"div",25),t.YNc(44,Z,2,0,"button",6),t.qZA()()),2&e){let o,r,s,g;t.Q6J("ngIf",n.isLoading),t.xp6(1),t.Q6J("ngClass",t.VKq(23,h,n.isModalVisible)),t.xp6(6),t.Oqu(n.rewardTitle&&""!==n.rewardTitle?n.rewardTitle:"Redeem Reward"),t.xp6(1),t.Q6J("ngIf",n.rewardMessage&&""!==n.rewardMessage),t.xp6(4),t.Oqu(t.lcZ(13,16,n.selectedReward.title)),t.xp6(3),t.Oqu(n.selectedReward.description),t.xp6(1),t.Q6J("ngIf",n.canRedeem),t.xp6(1),t.Q6J("ngIf",n.isGrantPointsModalVisible),t.xp6(12),t.hij("Name: ",t.lcZ(30,18,null!==(o=null==n.user?null:n.user.name)&&void 0!==o?o:""),""),t.xp6(3),t.hij("Card Number: ",null!==(r=null==n.user?null:n.user.card_number)&&void 0!==r?r:"",""),t.xp6(3),t.hij("Expiration: ",t.xi3(36,20,null==n.user?null:n.user.card_expiration_date,"MM/dd/yyyy"),""),t.xp6(3),t.hij("Points: ",null==n.user?null:n.user.points,""),t.xp6(1),t.Q6J("ngClass",t.VKq(25,O,null!==(s=null==n.user?null:n.user.card_type)&&void 0!==s?s:"silver")),t.xp6(1),t.Oqu(null!==(g=null==n.user?null:n.user.card_type)&&void 0!==g?g:"silver"),t.xp6(2),t.Q6J("ngForOf",n.logos),t.xp6(2),t.Q6J("ngIf",n.adminButtonRole.includes(n.userRole))}},directives:[c.O5,c.mk,c.sg],pipes:[c.gd,c.rS,c.uU],styles:[".card-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;height:100%;margin:0;padding:0;position:relative}.loyalty-card[_ngcontent-%COMP%]{background-image:url(/assets/images/cardbackground.jpg);background-size:cover;background-position:center;border-radius:20px;width:600px;height:auto;box-shadow:0 6px 30px #0003;outline:2px solid white;overflow:hidden;transition:transform .3s ease,box-shadow .3s ease;transform:translateY(60px);padding-bottom:30px}.card-header[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:flex-start;align-items:flex-start;width:100%;background-color:#0a2a3d;padding:20px;height:150px;margin:0;color:#fff;position:relative}.header-top-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;width:100%;margin-bottom:0;padding-top:5px;padding-bottom:0}.logo-container[_ngcontent-%COMP%]{display:flex;align-items:center;margin-top:-10px}.logo[_ngcontent-%COMP%]{position:relative;transform:translate(-25px,-25px);height:50px;width:auto}.logo-text[_ngcontent-%COMP%]{position:relative;transform:translate(-50px,-28px);height:80px;width:auto}.header-title[_ngcontent-%COMP%]{transform:translate(-50px,-23px);font-size:18px;font-weight:700;color:#fff;text-align:center;flex-grow:1;margin-top:-5px}.card-info[_ngcontent-%COMP%]{transform:translateY(-45px);text-align:left;font-size:14px;color:#fff;margin-top:10px}.card-info-2[_ngcontent-%COMP%]{transform:translate(200px,-64px)}.card-info[_ngcontent-%COMP%]   .card-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;padding:2px 0}.card-type[_ngcontent-%COMP%]{position:absolute;top:20px;right:20px;font-weight:700;padding:8px 15px;font-size:14px;box-shadow:0 2px 10px #0000001a;transform:translate(20px,-20px)}.silver[_ngcontent-%COMP%]{background-color:#d8d8d8;color:#333}.gold[_ngcontent-%COMP%]{background-color:gold;color:#333}.platinum[_ngcontent-%COMP%]{background-color:purple;color:#fff}.item-collection[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(5,1fr);grid-gap:12px;gap:12px;margin-top:25px}.item[_ngcontent-%COMP%]{position:relative;width:100%;height:100%;display:flex;align-items:center;justify-content:center}.item[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;border-radius:8px;transition:opacity .3s ease,transform .3s ease-in-out;z-index:1}.item[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]:hover{transform:scale(1.1);opacity:.8}.reward-logo[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:16px;font-weight:700;text-align:center;color:#0a2a3d;z-index:2;text-shadow:0px 2px 10px rgba(0,0,0,.6);pointer-events:none}.reward-description[_ngcontent-%COMP%]{text-align:left;padding:15px;background-color:#e0f7fa;box-shadow:0 4px 20px #0000001a;border-radius:20px;width:100%;margin:20px auto}.loyalty-btn-container[_ngcontent-%COMP%]{display:flex;justify-content:center;width:100%;transform:translateY(75px)}.loyalty-btn[_ngcontent-%COMP%]{width:150px;font-size:16px;background-color:#1c841c;color:#fff;padding:12px 0;border:none;border-radius:10px;cursor:pointer;font-weight:700;box-shadow:0 4px 15px #0000001a;display:inline-block}.redeem-btn[_ngcontent-%COMP%]:hover{background-color:#7d9eb1}.modal[_ngcontent-%COMP%]{display:none;position:fixed;z-index:999;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:#00000080;justify-content:center;align-items:center}.modal.show[_ngcontent-%COMP%]{display:flex}.modal-content[_ngcontent-%COMP%]{background-color:#fff;border-radius:10px;padding:20px;width:80%;max-width:400px;text-align:center;box-shadow:0 6px 15px #0000004d}.close-btn[_ngcontent-%COMP%]{color:#aaa;float:right;font-size:28px;font-weight:700;cursor:pointer;position:absolute;top:10px;right:20px;transition:color .3s ease}.close-btn[_ngcontent-%COMP%]:hover{color:#000}@media screen and (max-width: 600px){.card-container[_ngcontent-%COMP%]{justify-content:center;align-items:flex-start}.card-header[_ngcontent-%COMP%]{height:200px}.loyalty-card[_ngcontent-%COMP%]{width:95%;height:auto;transform:translateY(30px)}.item-collection[_ngcontent-%COMP%]{margin-bottom:50px}.loyalty-btn-container[_ngcontent-%COMP%]{display:flex;justify-content:center;width:100%;transform:translateY(30px);padding-top:10%}.loyalty-btn[_ngcontent-%COMP%]{width:150px;font-size:16px;background-color:#1c841c;color:#fff;padding:12px 0;border:none;border-radius:10px;cursor:pointer;font-weight:700;box-shadow:0 4px 15px #0000001a;display:inline-block}.card-info-2[_ngcontent-%COMP%]{transform:translate(0)}.item-collection[_ngcontent-%COMP%]{grid-template-columns:repeat(3,1fr)}}.overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#00000080;display:flex;justify-content:center;align-items:center;z-index:1100;visibility:hidden}.loader-img[_ngcontent-%COMP%]{width:60px;height:60px;border-radius:50%;object-fit:cover;box-shadow:0 0 20px #0003,0 0 40px #0000001a;mask-image:radial-gradient(circle,rgba(0,0,0,1) 50%,rgba(0,0,0,0) 100%);-webkit-mask-image:radial-gradient(circle,rgba(0,0,0,1) 50%,rgba(0,0,0,0) 100%)}.overlay.active[_ngcontent-%COMP%]{visibility:visible}"]}),i})();var R=l(1735),L=l(5107);const k=[{path:"",component:T,canActivate:[R.p,L.a],data:{role:["user","admin","super-admin"]}}];let A=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[[c.ez,u.Bz.forChild(k)]]}),i})()}}]);